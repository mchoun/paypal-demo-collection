<form action="/checkout" id="hosted-fields-form" method="post">
  <label for="card-number">Card Number</label>
  <div id="card-number"></div>

  <label for="cvv">CVV</label>
  <div id="cvv"></div>

  <label for="expiration-date">Expiration Date</label>
  <div id="expiration-date"></div>

  <div id="checkout-message"></div>

  <input type="submit" value="Pay" disabled />
</form>

<script>
  (async () => {
  var form = document.querySelector('#hosted-fields-form');
  var submit = document.querySelector('input[type="submit"]');

  let clientToken = await fetch("/api/client_token")
  .then(response => response.text())
  .catch(error => console.log('error', error));

  braintree.client.create({
    // Insert your tokenization key here
    authorization: clientToken,
  }, function (clientErr, clientInstance) {
    if (clientErr) {
      console.error(clientErr);
      return;
    }

    // Create a hostedFields component to initialize the form

    braintree.hostedFields.create({
      client: clientInstance,
      // Customize the Hosted Fields.
      // More information can be found at:
      // https://developers.braintreepayments.com/guides/hosted-fields/styling/javascript/v3
      styles: {
        'input': {
          'font-size': '14px'
        },
        'input.invalid': {
          'color': 'red'
        },
        'input.valid': {
          'color': 'green'
        }
      },
      // Configure which fields in your card form will be generated by Hosted Fields instead
      fields: {
        number: {
          container: '#card-number',
          placeholder: '4111 1111 1111 1111'
        },
        cvv: {
          container: '#cvv',
          placeholder: '123'
        },
        expirationDate: {
          container: '#expiration-date',
          placeholder: '10/2022'
        }
      }
    }, function (hostedFieldsErr, instance) {
      if (hostedFieldsErr) {
        console.error(hostedFieldsErr);
        return;
      }

      // Once the fields are initialized enable the submit button
      submit.removeAttribute('disabled');

      // Initialize the form submit event
      form.addEventListener('submit', function (event) {
        event.preventDefault();
        // When the user clicks on the 'Submit payment' button this code will send the
        // encrypted payment information in a variable called a payment method nonce
        instance.tokenize(function (tokenizeErr, payload) {
          if (tokenizeErr) {
            console.error(tokenizeErr);
            return;
          }

          $.ajax({
            type: 'POST',
            url: '/api/checkout',
            data: {'paymentMethodNonce': payload.nonce}
          }).done(function(result) {
            // Since the following code will overwrite the contents of
            // your page with a success or error message, first teardown
            // the Hosted Fields form to remove any extra event listeners
            // and iframes that the Braintree SDK added to your page
            instance.teardown(function (teardownErr) {
              if (teardownErr) {
                console.error('Could not tear down the Hosted Fields form!');
              } else {
                console.info('Hosted Fields form has been torn down!');
                // Remove the 'Submit payment' button
                $('#hosted-fields-form').remove();
              }
            });

            if (result.success) {
              $('#checkout-message').html('<h1>Success</h1><p>Your Hosted Fields form is working! Check your <a href="https://sandbox.braintreegateway.com/login">sandbox Control Panel</a> for your test transactions.</p><p>Refresh to try another transaction.</p>');
            } else {
              $('#checkout-message').html('<h1>Error</h1><p>Check your console.</p>');
            }
          });
        });
      }, false);
    });
  });
  }
  )();
</script>